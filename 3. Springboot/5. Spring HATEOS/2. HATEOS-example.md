# HATEOAS-ga asoslangan REST API yaratish

Bu yo‘riqnoma Spring Boot va Spring HATEOAS yordamida foydalanuvchi ma'lumotlarini qaytaradigan REST API-ni qanday yaratishni ko‘rsatadi. API quyidagi JSON formatida javob qaytaradi:

```json
{
  "id": 123,
  "name": "Ali Valiyev",
  "email": "ali@example.com",
  "_links": {
    "self": { "href": "/users/123" },
    "posts": { "href": "/users/123/posts" },
    "update": { "href": "/users/123", "method": "PUT" },
    "delete": { "href": "/users/123", "method": "DELETE" }
  }
}
```

## Loyiha sozlamalari

### 1. Loyiha yaratish
Spring Boot loyihasini yaratish uchun [Spring Initializr](https://start.spring.io/) dan foydalaning yoki quyidagi bog‘liqliklarni `pom.xml` fayliga qo‘shing.

#### `pom.xml`
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.example</groupId>
    <artifactId>hateoas-demo</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>hateoas-demo</name>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.3.2</version>
        <relativePath/>
    </parent>

    <dependencies>
        <!-- Spring Boot Web -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <!-- Spring HATEOAS -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-hateoas</artifactId>
        </dependency>
        <!-- Spring Data JPA (ma'lumotlar bazasi uchun) -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>
        <!-- H2 ma'lumotlar bazasi (test uchun) -->
        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <scope>runtime</scope>
        </dependency>
        <!-- Lombok (boilerplate kodni kamaytirish uchun) -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>
```

### 2. Ma'lumotlar bazasi sozlamalari
H2 ma'lumotlar bazasidan foydalanamiz (test uchun). `src/main/resources/application.properties` fayliga quyidagi sozlamalarni qo‘shing:

```properties
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.h2.console.enabled=true
spring.jpa.hibernate.ddl-auto=update
```

## Kod tuzilishi

### 3. Entity klasi
Foydalanuvchi ma'lumotlarini saqlash uchun `User` entity klasi yaratiladi.

#### `src/main/java/com/example/hateoasdemo/entity/User.java`
```java
package com.example.hateoasdemo.entity;

import jakarta.persistence.Entity;
import jakarta.persistence.Id;
import lombok.Getter;
import lombok.Setter;

@Entity
@Getter
@Setter
public class User {
    @Id
    private Long id;
    private String name;
    private String email;
}
```

### 4. Repository interfeysi
Spring Data JPA yordamida ma'lumotlar bazasi bilan ishlash uchun `UserRepository` interfeysi yaratiladi.

#### `src/main/java/com/example/hateoasdemo/repository/UserRepository.java`
```java
package com.example.hateoasdemo.repository;

import com.example.hateoasdemo.entity.User;
import org.springframework.data.jpa.repository.JpaRepository;

public interface UserRepository extends JpaRepository<User, Long> {
}
```

### 5. Controller klasi
HATEOAS havolalarini qaytaradigan REST controller yaratiladi.

#### `src/main/java/com/example/hateoasdemo/controller/UserController.java`
```java
package com.example.hateoasdemo.controller;

import com.example.hateoasdemo.entity.User;
import com.example.hateoasdemo.repository.UserRepository;
import org.springframework.hateoas.EntityModel;
import org.springframework.hateoas.server.mvc.WebMvcLinkBuilder;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.Optional;

import static org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.linkTo;
import static org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.methodOn;

@RestController
@RequestMapping("/users")
public class UserController {

    private final UserRepository userRepository;

    public UserController(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    @GetMapping("/{id}")
    public ResponseEntity<EntityModel<User>> getUser(@PathVariable Long id) {
        Optional<User> user = userRepository.findById(id);
        if (user.isEmpty()) {
            return ResponseEntity.notFound().build();
        }

        EntityModel<User> userModel = EntityModel.of(user.get());
        userModel.add(linkTo(methodOn(UserController.class).getUser(id)).withSelfRel());
        userModel.add(linkTo(methodOn(UserController.class).getUserPosts(id)).withRel("posts"));
        userModel.add(linkTo(methodOn(UserController.class).getUser(id)).withRel("update").expand().withMethod("PUT"));
        userModel.add(linkTo(methodOn(UserController.class).getUser(id)).withRel("delete").expand().withMethod("DELETE"));

        return ResponseEntity.ok(userModel);
    }

    // Misol uchun posts endpointi (haqiqiy implementatsiya qilinmagan)
    @GetMapping("/{id}/posts")
    public ResponseEntity<String> getUserPosts(@PathVariable Long id) {
        return ResponseEntity.ok("Posts for user " + id);
    }
}
```

### 6. Test ma'lumotlari
Loyiha ishga tushganda test ma'lumotlarini qo‘shish uchun `CommandLineRunner` ishlatiladi.

#### `src/main/java/com/example/hateoasdemo/HateoasDemoApplication.java`
```java
package com.example.hateoasdemo;

import com.example.hateoasdemo.entity.User;
import com.example.hateoasdemo.repository.UserRepository;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;

@SpringBootApplication
public class HateoasDemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(HateoasDemoApplication.class, args);
    }

    @Bean
    public CommandLineRunner initData(UserRepository userRepository) {
        return args -> {
            User user = new User();
            user.setId(123L);
            user.setName("Ali Valiyev");
            user.setEmail("ali@example.com");
            userRepository.save(user);
        };
    }
}
```

## Loyihani ishga tushirish

1. Loyihani `mvn spring-boot:run` buyrug‘i bilan ishga tushiring.
2. `http://localhost:8080/users/123` manziliga GET so‘rov yuboring (masalan, Postman orqali).
3. Javob quyidagicha bo‘ladi:

```json
{
  "id": 123,
  "name": "Ali Valiyev",
  "email": "ali@example.com",
  "_links": {
    "self": { "href": "http://localhost:8080/users/123" },
    "posts": { "href": "http://localhost:8080/users/123/posts" },
    "update": { "href": "http://localhost:8080/users/123", "method": "PUT" },
    "delete": { "href": "http://localhost:8080/users/123", "method": "DELETE" }
  }
}
```

## Qo‘shimcha eslatmalar
- **Havolalar**: Yuqoridagi misolda `posts` endpointi faqat namoyish uchun qo‘shilgan. Haqiqiy loyihada bu endpointni to‘liq implementatsiya qilish kerak.
- **Ma'lumotlar bazasi**: H2 o‘rniga MySQL, PostgreSQL yoki boshqa ma'lumotlar bazasidan foydalanish uchun `application.properties` faylida sozlamalarni o‘zgartiring.
- **Spring HATEOAS**: `EntityModel` va `WebMvcLinkBuilder` yordamida HATEOAS havolalari osongina qo‘shiladi.
- **Kengaytirish**: API’ga qo‘shimcha endpointlar (masalan, `POST /users`, `PUT /users/{id}`) qo‘shish orqali funksionallikni kengaytirish mumkin.

## Xulosa
Ushbu loyiha HATEOAS tamoyillariga asoslangan REST API-ni Spring Boot yordamida yaratishni ko‘rsatadi. Spring HATEOAS kutubxonasi yordamida mijozga dinamik havolalar taqdim etiladi, bu API’ni mustaqil va moslashuvchan qiladi. Agar qo‘shimcha funksiyalar yoki endpointlar qo‘shish kerak bo‘lsa, loyiha osongina kengaytirilishi mumkin.
